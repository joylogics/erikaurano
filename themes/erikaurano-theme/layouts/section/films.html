{{ define "main" }}
  <div id="body-content">
    {{ partial "section-subheader.html" . }}
    
    <div class="films-controls">
      <div class="role-filters">
        <button class="filter-btn active" data-role="all">All</button>
        <button class="filter-btn" data-role="Director">Director</button>
        <button class="filter-btn" data-role="Writer">Writer</button>
        <button class="filter-btn" data-role="Production Designer">Production Designer</button>
      </div>
    </div>

    <div class="films-grid">
      {{ range .Pages.ByWeight }}
        {{ $videoEmbed := "" }}
        {{ if .Params.link }}
          {{ if findRE "^https?://(?:www\\.)?(?:youtube\\.com/watch\\?v=|youtu\\.be/)([^&?/]+)" .Params.link }}
            {{ $youtubeId := replaceRE "^https?://(?:www\\.)?(?:youtube\\.com/watch\\?v=|youtu\\.be/)([^&?/]+).*" "$1" .Params.link }}
            {{ $videoEmbed = printf "https://www.youtube.com/embed/%s" $youtubeId }}
          {{ else if findRE "^https?://(?:www\\.)?vimeo\\.com/([0-9]+)" .Params.link }}
            {{ $vimeoId := replaceRE "^https?://(?:www\\.)?vimeo\\.com/([0-9]+).*" "$1" .Params.link }}
            {{ $videoEmbed = printf "https://player.vimeo.com/video/%s" $vimeoId }}
          {{ end }}
        {{ end }}
        <div class="film-card{{ if or .Params.playlist $videoEmbed }} has-embedded-video{{ end }}" data-roles="{{ delimit .Params.roles " " }}">
          <div class="film-preview">
            {{ if .Params.playlist }}
              <div class="video-container">
                <video poster="{{ .Params.preview }}" data-playlist="{{ .Params.playlist }}" controls></video>
              </div>
            {{ else if $videoEmbed }}
              <div class="video-container">
                <iframe 
                  src="{{ $videoEmbed }}" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen
                  loading="lazy"
                  title="{{ .Title }}"
                ></iframe>
              </div>
            {{ else if .Params.preview }}
              <img src="{{ .Params.preview }}" alt="{{ .Title }}" loading="lazy">
            {{ end }}
            <div class="film-overlay">
              <a href="{{ .Permalink }}" class="film-overlay-link">
                <span class="view-details">View Details</span>
              </a>
            </div>
          </div>
          <a href="{{ .Permalink }}" class="film-info-link">
            <div class="film-info">
              <h3>{{ .Title }}</h3>
              <div class="film-meta">
                <span class="film-year">{{ .Params.year }}</span>
                <div class="film-roles">
                  {{ range .Params.roles }}
                    <span class="role-badge">{{ . }}</span>
                  {{ end }}
                </div>
              </div>
              <p class="film-description">{{ .Description }}</p>
            </div>
          </a>
        </div>
      {{ end }}
    </div>
  </div>


{{ end }}
