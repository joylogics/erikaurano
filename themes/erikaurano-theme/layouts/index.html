{{ define "main" }}
<!-- Background Reel -->
<div class="background-reel">
  <div class="reel-content">
    <!-- Collect all film content for the reel -->
    {{ $reelItems := slice }}
    
    <!-- Add video content from films -->
    {{ range .Site.RegularPages }}
      {{ if eq .Section "films" }}
        <!-- Only include films with custom reel playlists -->
        {{ if .Params.reel_playlist }}
          {{ $reelItems = $reelItems | append (dict "type" "reel-video" "src" .Params.reel_playlist "poster" .Params.preview "title" .Title) }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    <!-- Render reel items -->
    <!-- DEBUG: Total reel items: {{ len $reelItems }} -->
    {{ range $index, $item := $reelItems }}
      <!-- DEBUG: Item {{ $index }}: {{ $item.type }} - {{ $item.src }} from {{ $item.title }} -->
      <div class="reel-item {{ if eq $index 0 }}active{{ end }}" data-index="{{ $index }}" data-type="{{ $item.type }}">
        {{ if eq $item.type "reel-video" }}
          <video 
            data-playlist="{{ $item.src }}" 
            {{ if $item.poster }}poster="{{ $item.poster }}"{{ end }}
            muted 
            loop 
            preload="metadata"
            playsinline>
            <source src="{{ $item.src }}" type="application/vnd.apple.mpegurl">
          </video>
        {{ else if eq $item.type "video" }}
          <video 
            data-playlist="{{ $item.src }}" 
            {{ if $item.poster }}poster="{{ $item.poster }}"{{ end }}
            muted 
            loop 
            preload="metadata"
            playsinline>
            <source src="{{ $item.src }}" type="application/vnd.apple.mpegurl">
          </video>
        {{ end }}
      </div>
    {{ end }}
  </div>
  <div class="reel-overlay"></div>
</div>

<div id="body-content">
  <div class="nav-wrapper">
    <ul class="nav-list">
      {{ range .Site.Params.navItems }}
      <li class="nav-item">
        <div class="nav-image">
          <img src="{{ .image | relURL }}" alt="{{ .name }}">
        </div>
        <div class="nav-text">
          <a href="{{ .url }}">{{ .name }}</a>
        </div>
      </li>
      {{ end }}
    </ul>
  </div>
</div>
{{ end }}

